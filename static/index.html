<!doctype html>
<html>
<head>
<title>Hedgcoxe A/V Scene Switcher</title>
<style>
.controlpanel {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(3, 1fr);
    grid-gap: 5px;
}
.controlpanelbutton__img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border: 1px solid black;
    box-shadow: 9px 9px #999;
}
.controlpanelbutton__img:hover {
    border: 1px solid black;
    box-shadow: 9px 9px #9f9;
}
.controlpanelbutton__img:active {
    background-color: #eee;
    border: 1px solid black;
    box-shadow: 5px 5px #555;
    transform: translateY(5px);
}
</style>
</head>
<body onload="initControlPanel();">
<header>
</header>
<nav>
</nav>
<div class='controlpanel' id='controlpanel'>
</div>
<footer>
</footer>
<script type='text/javascript'>

var config = {};

function initControlPanel() {
    var httpGet = new XMLHttpRequest();
    httpGet.open("GET", '/config?qid=' + new Date().getTime());
    httpGet.setRequestHeader('Content-Type', 'application/json');
    httpGet.onreadystatechange = function() {
        if(httpGet.readyState == 4) {
            var controlPanel = document.getElementById('controlpanel');
            config = JSON.parse(httpGet.responseText);
            var scenesHTML = '';
            var scenenames = Object.keys(config['scenes']);
            scenenames.forEach( (scenename, index) => {
                var scene = config['scenes'][scenename];
                scenesHTML = scenesHTML +
                    "<figure class='controlpanelbutton'><img src='/img/" + 
                    scene['imgagefile'] + 
                    "' class='controlpanelbutton__img' alt='" + 
                    scene['description'] +
                    "' title='" +
                    scene['description'] +
                    "' onclick='loadScene(\"" +
                    scenename + "\");'></figure>";
            });
            controlPanel.innerHTML = scenesHTML;
        }
    };
    httpGet.send();
}

function loadScene(scenename) {
    var jsonSubmit = JSON.stringify(config['scenes'][scenename]);
    console.log('submitting: ' + jsonSubmit);
    var httpPost = new XMLHttpRequest();
    httpPost.open("POST", '/scene', true);
    httpPost.setRequestHeader('Content-Type', 'application/json');
    httpPost.send(jsonSubmit);
}
</script>
</body>
</html>
